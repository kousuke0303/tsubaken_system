<div class="table-responsible">
  <table class="table table-bordered text-nowrap table-column-type">
    <tr>
      <th rowspan="2">状況</th>
      <th rowspan="2">作業名称</th>
      <th rowspan="2">担当者</th>
      <th rowspan="2">材料</th>
      <th rowspan="2">写真/詳細</th>
      <th>開始予定日</th>
      <th>完了予定日</th>
    </tr>
    <tr>
      <th>開始日</th>
      <th>完了日</th>
    </tr>
    <% if @construction_schedules.present? %>
      <% @construction_schedules.each_with_index do |construction, index| %>
        <tr>
          <td rowspan="2"><%= construction.status_i18n %></td>
          <td rowspan="2"><%= construction.title %></td>
          <td rowspan="2"><%= construction.supplier_disp(construction.supplier) %></td>
          <td rowspan="2">
            <% if construction.construction_schedule_materials.present? %>
              <% construction.construction_schedule_materials.each do |construction_schedule_material| %>
                <%= content_tag(:div, "#{Material.find(construction_schedule_material.material_id).name}") %>
              <% end %>
            <% end %>
          </td>
          <td rowspan="2" class="text-center">
            <div>
              <%= link_to "表示", picture_employees_matter_construction_schedule_path(@matter, construction), remote: true, class: "btn btn-dark" %>
            </div>
          </td>
          <td class="text-center"><%= construction.scheduled_started_on_disp %></td>
          <td class="text-center"><%= construction.scheduled_finished_on_disp %></td>
        </tr>
        <tr>
          <td class="text-center"><%= construction.started_on_display_for_external_staff(current_external_staff) %></td>
          <td class="text-center"><%= construction.finished_on_display_for_external_staff(current_external_staff) %></td>
        </tr>
      <% end %>
    <% end %>
  </table>
  
</div>

<script>
  <% @construction_schedules.each do |construction| %>
    $('#started_on_for_<%= construction.id %>').on('click', function(){
      $.ajax({
        type: "PATCH",
        url: "<%= external_staffs_matter_construction_schedule_path(@matter, construction) %>",
        data: { object: "started_on"}
      });
    });
    
    $('#finished_on_for_<%= construction.id %>').on('click', function(){
      $.ajax({
        type: "PATCH",
        url: "<%=external_staffs_matter_construction_schedule_path(@matter, construction) %>",
        data: { object: "finished_on"}
      }); 
    });
  <% end %>
</script>