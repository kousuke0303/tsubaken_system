<div class="col-lg-12 col-md-12">
  <h2>
    見積案件一覧
    <%= link_to new_employees_estimate_matter_path, remote: true, class: "btn btn-dark float-r" do %>
      <i class="fas fa-plus"></i> 新規見積案件
    <% end %>
  </h2>
  <div class="card text-center tab-wrapper">
    <div class="card-body">
      <table class="table table-sm common-table">
        <tr>
          <th>タイトル</th>
          <th>顧客</th>
          <th>最新ステータス</th>
          <th>担当者</th>
        </tr>
        <% if current_admin || current_manager %>
          <% @estimate_matters.each do |estimate_matter| %>
            <tr class="tr-link" data-link="<%= employees_estimate_matter_path(estimate_matter) %>">
              <td><%= estimate_matter.title %></td>
              <td><%= estimate_matter.client.name %></td>
              <% sales_status = @sales_statuses.where(estimate_matter_id: estimate_matter.id).first %>
              <% if sales_status %>
                <td><%= sales_status.status_i18n %></td>
                <td><%= sales_status.staff_name %><%= sales_status.external_staff_name %></td>
              <% else %>
                <td></td>
                <td></td>
              <% end %>
            </tr>
          <% end %>
        <% elsif current_staff %>
          <% @staff_estimate_matters.each do |staff_estimate_matter| %>
            <tr class="tr-link" data-link="<%= employees_estimate_matter_path(staff_estimate_matter) %>">
              <td><%= staff_estimate_matter.title %></td>
              <td><%= staff_estimate_matter.client.name %></td>
              <% sales_status = @sales_statuses.where(estimate_matter_id: staff_estimate_matter.id).first %>
              <% if sales_status %>
                <td><%= sales_status.status_i18n %></td>
                <td><%= sales_status.staff_name %><%= sales_status.external_staff_name %></td>
              <% else %>
                <td></td>
                <td></td>
              <% end %>
            </tr>
          <% end %>
         <% elsif current_external_staff %>
           <% @external_staff_estimate_matters.each do |external_staff_estimate_matter| %>
            <tr class="tr-link" data-link="<%= employees_estimate_matter_path(external_staff_estimate_matter) %>">
              <td><%= external_staff_estimate_matter.title %></td>
              <td><%= external_staff_estimate_matter.client.name %></td>
              <% sales_status = @sales_statuses.where(estimate_matter_id: external_staff_estimate_matter.id).first %>
              <% if sales_status %>
                <td><%= sales_status.status_i18n %></td>
                <td><%= sales_status.staff_name %><%= sales_status.external_staff_name %></td>
              <% else %>
                <td></td>
                <td></td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <% @client_estimate_matters.each do |client_estimate_matter| %>
            <tr class="tr-link" data-link="<%= employees_estimate_matter_path(client_estimate_matter) %>">
              <td><%= client_estimate_matter.title %></td>
              <td><%= client_estimate_matter.client.name %></td>
              <% sales_status = @sales_statuses.where(estimate_matter_id: client_estimate_matter.id).first %>
              <% if sales_status %>
                <td><%= sales_status.status_i18n %></td>
                <td><%= sales_status.staff_name %><%= sales_status.external_staff_name %></td>
              <% else %>
                <td></td>
                <td></td>
              <% end %>
            </tr>
          <% end %>
        <% end %>
      </table>
    </div>
  </div>
</div>
