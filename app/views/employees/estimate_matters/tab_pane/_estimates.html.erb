<table class="table table-sm common-table">
  <tr>
    <th>見積名</th>
    <th>編集</th>
    <th>工事カテゴリ名</th>
    <th>編集</th>
    <th>工事・素材名</th>
    <th>耐用年数</th>
    <th>単価</th>
    <th>単位</th>
    <th>数量</th>
    <th>合計金額</th>
    <th>編集</th>
  </tr>
  <% estimates.each do |estimate| %>
    <tr>
      <td><%= estimate.title %></td>
      <td>      
        <%= link_to(edit_employees_estimate_matter_estimate_path(estimate_matter, estimate.id), remote: true) do %>
          <button class="btn btn-sm btn-dark"><i class="fa fa-edit"></i></button>
        <% end %>         
      </td>
      <td><%= estimate.category_name %></td>
      <td>
        <% if estimate.category_id.present? %>
          <%= link_to(edit_employees_estimate_matter_category_path(estimate_matter, estimate.category_id), remote: true) do %>
            <button class="btn btn-sm btn-dark"><i class="fa fa-edit"></i></button>
          <% end %>          
        <% end %>
      </td>
      <% if estimate.material_id.present? %>
        <td><%= estimate.material_name %></td>
        <td><%= estimate.service_life %></td>
        <td><%= estimate.material_price %></td>
        <td><%= estimate.material_unit %></td>
        <td><%= estimate.material_amount %></td>
        <td></td>
        <td>
          <%= link_to(edit_employees_estimate_matter_material_path(estimate_matter, estimate.material_id), remote: true) do %>
            <button class="btn btn-sm btn-dark"><i class="fa fa-edit"></i></button>
          <% end %>
        </td>
      <% else %>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      <% end %>
    </tr>
  <% end %>
</table>

<% estimates.group_by {|estimate| estimate.id }.each do |estimate| %>
  <% estimate = estimate[1] %>
  <div class="estimate-box flex mt-1e">
    <!-- 見積のプラン名 -->
    <div style="width: 20%; border: 1px solid black"><%= estimate[0].title %></div>

    <div style="width: 80%;">
      <% estimate.group_by { |category| category.category_id }.each do |category| %>
        <% category = category[1] %>
        <% if category[0].category_id %>
          <div class="flex" style="border:1px solid black;">
            <div style="width: 20%; border: 1px solid black"><%= category[0].category_name %></div>
            <div style="width: 80%;">
              <% category.group_by { |materials| materials.material_id }.each do |materials| %>
                <% materials = materials[1] %>
                <% materials.each do |material| %>
                  <div class="flex" style="border:1px solid black;">
                    <div style="width: 20%; border: 1px solid black"><%= material.material_name %></div>
                    <div style="width: 20%; border: 1px solid black"><%= material.material_price %></div>
                    <div style="width: 20%; border: 1px solid black"><%= material.material_unit %></div>
                    <div style="width: 20%; border: 1px solid black"><%= material.material_amount %></div>
                    <div style="width: 20%;"><%=  %></div>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
